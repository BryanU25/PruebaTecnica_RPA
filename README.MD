# üß† Prueba T√©cnica ‚Äì Ingeniero de Automatizaci√≥n RPA (MISSION SAS)

Soluci√≥n desarrollada para automatizar el monitoreo de condiciones de viaje, incluyendo la recolecci√≥n, procesamiento, y visualizaci√≥n de datos meteorol√≥gicos y en un dashboard interactivo con m√©tricas, calculo de  √çndice de Viabilidad de Viaje (IVV) y alertas.

---

## üèóÔ∏è Arquitectura de la soluci√≥n

La arquitectura del proyecto se basa en un modelo **modular y escalable**, dise√±ado para ejecutar una automatizaci√≥n de forma independiente al dashboard, permitiendo mantenimiento y extensiones futuras.  

El flujo general se divide en tres capas principales:

1. **Capa de Extracci√≥n y Procesamiento (Backend)**
   - Se encarga de obtener informaci√≥n desde las APIs p√∫blicas:
     - üå¶Ô∏è *Open-Meteo* ‚Üí datos clim√°ticos (temperatura, viento, lluvia, UV y pronostico)
     - üí± *ExchangeRate API* ‚Üí tipos de cambio y simulaci√≥n de hist√≥rico
     - ‚è∞ *WorldTimeAPI* ‚Üí hora local y diferencia horaria con Bogot√°
   - Los datos se transforman en estructuras limpias y estandarizadas (`.json`).

2. **Capa de Automatizaci√≥n (Scheduler)**
   - Usa el m√≥dulo `automatizador.py` para ejecutar el flujo completo cada 30 minutos.
   - Versiona autom√°ticamente los resultados con timestamp (`resultado_general_YYYYMMDD_HHMMSS.json`).
   - Registra todos los eventos en logs rotativos:
     - `app.log` ‚Äî actividad general
     - `automatizacion.log` ‚Äî ejecuciones programadas
     - `error.log` ‚Äî errores cr√≠ticos

3. **Capa de Visualizaci√≥n (Frontend)**
   - Dashboard desarrollado con **Streamlit + Plotly**.
   - Permite visualizar m√©tricas recolectadas, alertas activas, pronostico de temperatura y niveles de riesgo (IVV).
   - Consume los archivos generados por el proceso autom√°tico o manual desde `/data`.

---

### üß† Diagrama de arquitectura general

```mermaid
graph TD
    A[Usuario / Evaluador] -->|Ejecuta| B[Dashboard Streamlit]
    B -->|Lee datos desde| C[(Archivos JSON en /data)]
    C -->|Visualizaci√≥n y an√°lisis| B 

    subgraph "Capa de Automatizaci√≥n"
        D[automatizador.py<br>Scheduler cada 30 min] --> E[main.py<br>Flujo principal]
        E --> F[procesar_ciudades.py<br>Integraci√≥n y IVV]
    end

    subgraph "Capa de Extracci√≥n"
        F --> G1[api_clima.py<br>Open-Meteo API]
        F --> G2[api_divisas.py<br>ExchangeRate API]
        F --> G3[api_tiempo.py<br>WorldTimeAPI]
    end

    subgraph "Capa de Logging"
        D --> H1[app.log]
        D --> H2[automatizacion.log]
        F --> H3[error.log]
    end
```

---

## üìÇ Estructura del proyecto:
```bash
PruebaTecnica_RPA/
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api_clima.py
‚îÇ   ‚îú‚îÄ‚îÄ api_divisas.py
‚îÇ   ‚îú‚îÄ‚îÄ api_tiempo.py
‚îÇ   ‚îú‚îÄ‚îÄ procesar_ciudades.py
‚îÇ   ‚îú‚îÄ‚îÄ automatizador.py
‚îÇ   ‚îî‚îÄ‚îÄ main.py
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ config.json
‚îÇ   ‚îî‚îÄ‚îÄ config_logs.py
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ resultado_general_*.json
‚îÇ
‚îú‚îÄ‚îÄ logs/
‚îÇ   ‚îú‚îÄ‚îÄ app.log
‚îÇ   ‚îú‚îÄ‚îÄ automatizacion.log
‚îÇ   ‚îî‚îÄ‚îÄ error.log
‚îÇ
‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îú‚îÄ‚îÄ app_dashboard.py
‚îÇ   ‚îî‚îÄ‚îÄ utils_dashboard.py
‚îÇ
‚îî‚îÄ‚îÄ requirements.txt
```
---

## üñ•Ô∏è Funcionalidades principales del Dashboard

| Secci√≥n | Descripci√≥n |
|----------|--------------|
| **Resumen general** | Tabla consolidada de todas las ciudades con m√©tricas clave: temperatura, viento, UV, precipitaci√≥n, tipo de cambio, IVV y nivel de riesgo coloreado. |
| **Pron√≥stico de temperatura (7 d√≠as)** | Gr√°fico din√°mico por ciudad con selector integrado. Muestra tendencias de temperatura m√°xima y m√≠nima. |
| **Comparativo de tipo de cambio** | Gr√°fico de barras horizontales comparativa del tipo de cambio actual de todas las ciudades. |
| **Resumen de alertas globales** | Panel consolidado con todas las alertas activas del sistema (clim√°ticas y financieras), ordenadas por severidad. |
| **Mapa de riesgo (IVV)** | Mapa mundial con puntos coloreados seg√∫n nivel de riesgo y tama√±o proporcional al IVV. |

---

## üîÑ Diagrama de flujo del proceso

```mermaid
flowchart TD
    A[Iniciar automatizador] --> B[Extraer datos de APIs]
    B --> C[Procesar ciudades]
    C --> D[Evaluar alertas y calcular IVV]
    D --> E[Generar JSON estructurado]
    E --> F[Registrar logs y errores]
    F --> G[Dashboard Streamlit]
    G --> H[Visualizaci√≥n de m√©tricas y alertas]
```

---

## üß© Estructura del archivo JSON generado

Cada ejecuci√≥n autom√°tica o manual genera un archivo en `/data/resultado_general_YYYYMMDD_HHMMSS.json` con la siguiente estructura:

```json
[
  {
    "timestamp": "2025-10-21T15:04:00Z",
    "ciudad": "Tokio",
    "clima": {
      "temperatura_actual": 13.6,
      "viento": 5.2,
      "uv": 0.0,
      "precipitacion": 48,
      "pronostico_7_dias": [...]
    },
    "finanzas": {
      "tipo_cambio_actual": 150.70,
      "variacion_diaria": -0.73,
      "tendencia_5_dias": "positiva"
    },
    "tiempo": null,
    "alertas": [],    
    "ivv_score": 100.0,
    "nivel_riesgo": "BAJO",
    "componentes_ivv": {
            "clima_score": 100,
            "cambio_score": 100,
            "uv_score": 100
        },
    "color": "#28a745",
    "motivo": null
  },
  ...
]
```
Este formato es el que espera recibir el dashboard para visualizar las m√©tricas, el nivel de riesgo (IVV), las alertas activas y el mapa general.

---

## ‚öôÔ∏è Instrucciones de instalaci√≥n y ejecuci√≥n

üîπ Requisitos previos
* Python 3.10 o superior
* Git instalado
* Entorno virtual (venv) recomendado

üîπ Instalaci√≥n
```bash
# Clonar el repositorio
git clone https://github.com/BryanU25/PruebaTecnica_RPA.git

# Ingresar al proyecto
cd PruebaTecnica_RPA

# Crear y activar entorno virtual
python -m venv venv
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate

# Instalar dependencias
pip install -r requirements.txt
```

üîπ Ejecuci√≥n manual del proceso
```bash
python -m src.main
```
Esto:
* Ejecuta el flujo de extracci√≥n y procesamiento de datos.
* Genera un archivo JSON con los resultados en la carpeta /data/.
* Registra toda la ejecuci√≥n en logs/app.log.

üîπ Ejecuci√≥n autom√°tica (cada 30 min)
```bash
python -m src.automatizador
```
Este m√≥dulo:
* Programa el flujo completo para ejecutarse cada 30 minutos.
* Versiona los resultados generando archivos tipo:
    - resultado_general_20251021_153000.json
* Registra cada ejecuci√≥n en logs/automatizacion.log.
* Si ocurre un error, lo documenta en logs/error.log.

üîπ Iniciar dashboard
```bash
python -m streamlit run dashboard/app_dashboard.py 
```
El dashboard:
* Detecta autom√°ticamente el archivo JSON m√°s reciente en /data/.
* Muestra la fecha y hora del registro en un formato legible:
    - ‚ÄúRegistro del 2025-10-21 a las 15:04:00‚Äù

* Permite:
    * Ver una tabla comparativa de todas las ciudades.
    * Explorar el pron√≥stico de temperatura (7 d√≠as) seleccionando ciudad.
    * Analizar el comparativo global de tipo de cambio.
    * Consultar el resumen de alertas activas globales.
    * Visualizar el mapa mundial del nivel de riesgo (IVV).

---

## üì¶ Descripci√≥n de m√≥dulos

| Archivo                  | Prop√≥sito principal                                                           |
| ------------------------ | ----------------------------------------------------------------------------- |
| **api_clima.py**         | Conexi√≥n con Open-Meteo API. Manejo de reintentos y validaci√≥n de estructura. |
| **api_divisas.py**       | Obtiene tipos de cambio desde ExchangeRate API y simula hist√≥rico de 5 d√≠as.  |
| **api_tiempo.py**        | Consulta zonas horarias y calcula diferencia con Bogot√°.                      |
| **procesar_ciudades.py** | Eval√∫a alertas, calcula IVV y genera estructura consolidada.                  |
| **main.py**              | M√≥dulo principal del flujo con manejador de errores globales y versionado.    |
| **automatizador.py**     | Ejecuta el proceso completo cada 30 minutos y versiona los resultados.        |
| **config_logs.py**       | Configura loggers rotativos: app.log, automatizacion.log y error.log.         |
| **utils_dashboard.py**   | Funciones auxiliares para el dashboard.                                       |
| **app_dashboard.py**     | Visualizaci√≥n interactiva de IVV y alertas en Streamlit.                      |

---

## üõ°Ô∏è Manejo de errores implementado

- Reintentos autom√°ticos: usando tenacity (3 intentos por API).
- Control de excepciones: try/except con registro en logs y recuperaci√≥n del flujo.
- Logs rotativos:
    * app.log ‚Äì operaciones generales
    * automatizacion.log ‚Äì ejecuciones programadas
    * error.log ‚Äì errores cr√≠ticos
- Validaciones preventivas: si faltan datos, el sistema retorna valores por defecto.
- Continuidad del proceso: fallos en una API no detienen la automatizaci√≥n general.